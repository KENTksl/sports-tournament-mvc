<div class="sidebar pe-4 pb-3">
    <nav class="navbar bg-light navbar-light">
        <a href="/admin" class="navbar-brand mx-4 mb-3">
            <h3 class="text-primary"><i class="fa fa-hashtag me-2"></i>Admin Space</h3>
        </a>
        <div class="d-flex align-items-center ms-4 mb-4">
            <div class="position-relative">
                <img class="rounded-circle" id="adminAvatar" src="https://graph.facebook.com/100000000000000/picture" alt="" style="width: 40px; height: 40px; object-fit: cover;">
                <div
                    class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
                </div>
            </div>
            <div class="ms-3">
                <h6 class="mb-0" id="adminName">Loading...</h6>
                <span>Admin</span>
            </div>
        </div>
        <div class="navbar-nav w-100">
            <a href="/admin" class="nav-item nav-link"><i class="fa fa-tachometer-alt me-2"></i>Bảng Điều Khiển</a>
            <a href="/admin/profile" class="nav-item nav-link"><i class="fa fa-user me-2"></i>Hồ Sơ Của Tôi</a>
            <a href="/admin/widget" class="nav-item nav-link"><i class="fa fa-th me-2"></i>Tiện Ích</a>
            <a href="/admin/match" class="nav-item nav-link"><i class="fa fa-table me-2"></i>Bảng</a>
            <a href="/admin/chart" class="nav-item nav-link"><i class="fa fa-chart-bar me-2"></i>Biểu Đồ</a>
            <div class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-trophy me-2"></i>Giải Đấu</a>
                <div class="dropdown-menu bg-transparent border-0">
                    <a href="/admin/football/tournament" class="dropdown-item">Bóng Đá</a>
                    <a href="/admin/team-registration" class="dropdown-item">Hồ Sơ Đội Tuyển</a>
                    <a href="/admin/tournament" class="dropdown-item">Khác</a>
                </div>
            </div>
            <a href="#" class="nav-item nav-link" id="logoutBtn"><i class="fa fa-sign-out-alt me-2"></i>Đăng Xuất</a>
        </div>
    </nav>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const currentLocation = location.href;
        const menuItems = document.querySelectorAll('.navbar-nav .nav-link, .dropdown-menu .dropdown-item');
        const menuLength = menuItems.length;
        for (let i = 0; i < menuLength; i++) {
            if (menuItems[i].href === currentLocation) {
                menuItems[i].classList.add("active");
                if (menuItems[i].classList.contains('dropdown-item')) {
                    const parentDropdown = menuItems[i].closest('.nav-item.dropdown');
                    if (parentDropdown) {
                        const toggle = parentDropdown.querySelector('.nav-link.dropdown-toggle');
                        if (toggle) toggle.classList.add('active');
                    }
                }
            }
        }

        // Fetch user data
        const token = localStorage.getItem('token');
        if (token) {
            fetch('/profile/data', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => {
                if (!response.ok) {
                   // If token invalid, maybe logout?
                   if (response.status === 401) {
                       localStorage.removeItem('token');
                       window.location.href = '/login';
                   }
                   return null;
                }
                return response.json();
            })
            .then(data => {
                if (data && data.success) {
                    const user = data.data;
                    document.getElementById('adminName').textContent = user.username || user.email;
                    if (user.avatar) {
                        document.getElementById('adminAvatar').src = user.avatar;
                    }
                    
                    // Update Top Navbar if elements exist
                    const topNavName = document.getElementById('topNavName');
                    const topNavAvatar = document.getElementById('topNavAvatar');
                    if (topNavName) topNavName.textContent = user.username || user.email;
                    if (topNavAvatar && user.avatar) topNavAvatar.src = user.avatar;
                }
            })
            .catch(err => console.error(err));
        } else {
            // No token, redirect to login
            window.location.href = '/login';
        }

        // Logout handler (Sidebar)
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('token');
                window.location.href = '/login';
            });
        }

        // Logout handler (Top Navbar)
        const topNavLogout = document.getElementById('topNavLogout');
        if (topNavLogout) {
            topNavLogout.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('token');
                window.location.href = '/login';
            });
        }
    });
</script>