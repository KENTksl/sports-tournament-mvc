<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partical/headercomponent'); %>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-bracket/0.11.1/jquery.bracket.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-bracket/0.11.1/jquery.bracket.min.css" />
    <style>
        /* Custom Styles for Tabs */
        .nav-pills .nav-link {
            border-radius: 5px;
            color: #333;
            font-weight: 600;
            background-color: #f8f9fa;
            margin-right: 5px;
            margin-bottom: 5px;
            border: 1px solid #dee2e6;
        }

        .nav-pills .nav-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        /* Bracket Styles */
        div.jQBracket .team {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            color: #333;
            font-weight: 600;
        }
        div.jQBracket .team.win {
            background-color: #e3f2fd;
            border-color: #0d6efd;
            color: #0d6efd;
        }
        div.jQBracket .score {
            background-color: #f1f1f1;
            color: #333;
            font-weight: bold;
        }

        /* Match Item Styles */
        .match-item {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 15px;
            transition: all 0.2s;
        }
        .match-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .match-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        .team-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #eee;
        }
    </style>
</head>

<body>
    <!-- Navbar Start -->
    <%- include('partical/menucomponent'); %>
    <!-- Navbar End -->

    <!-- Header Start -->
    <div class="container-fluid bg-primary py-5 px-0" style="margin-bottom: 90px;">
        <div class="row mx-0 align-items-center">
            <div class="col-lg-6 px-md-5 text-center text-lg-left">
                <h1 class="display-2 text-uppercase mb-3">
                    Chi Ti·∫øt Gi·∫£i ƒê·∫•u
                </h1>
                <p class="text-dark mb-4">
                    Th√¥ng tin chi ti·∫øt, l·ªãch thi ƒë·∫•u v√† k·∫øt qu·∫£.
                </p>
            </div>
            <div class="col-lg-6 px-0 text-right">
                <img class="img-fluid mt-5 mt-lg-0" src="/static/img/header.jpg" alt="">
            </div>
        </div>
    </div>
    <!-- Header End -->

    <!-- Detail Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <div class="mb-4">
                <a href="/football" class="btn btn-secondary">&larr; Quay l·∫°i danh s√°ch</a>
            </div>

            <!-- Tournament Info -->
            <div class="row mb-5">
                <div class="col-lg-4">
                    <img src="/static/uploads/tournaments/<%= tournament.image %>" onerror="this.src='/static/img/service-1.jpg'" class="img-fluid rounded w-100" alt="<%= tournament.name %>">
                </div>
                <div class="col-lg-8">
                    <h2 class="text-uppercase mb-3"><%= tournament.name %></h2>
                    <p><strong>BTC:</strong> <%= tournament.organizer %></p>
                    <p><strong>H√¨nh th·ª©c:</strong> <%= tournament.mode %></p>
                    <p><strong>S·ªë ƒë·ªôi:</strong> <%= tournament.teamsCount %></p>
                    <p><strong>Tr·∫°ng th√°i:</strong> 
                        <span class="badge badge-<%= tournament.status === 'ongoing' ? 'success' : (tournament.status === 'upcoming' ? 'warning' : 'secondary') %> p-2">
                            <%= tournament.status === 'ongoing' ? 'ƒêang di·ªÖn ra' : (tournament.status === 'upcoming' ? 'S·∫Øp di·ªÖn ra' : 'ƒê√£ k·∫øt th√∫c') %>
                        </span>
                    </p>
                    <p><strong>M√¥ t·∫£:</strong> <%= tournament.description || 'Ch∆∞a c√≥ m√¥ t·∫£' %></p>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <ul class="nav nav-pills mb-4" id="tournamentTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="fixtures-tab" data-toggle="pill" href="#fixtures" role="tab" aria-controls="fixtures" aria-selected="true">L·ªãch ƒê·∫•u</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="standings-tab" data-toggle="pill" href="#standings" role="tab" aria-controls="standings" aria-selected="false">BXH</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="stats-tab" data-toggle="pill" href="#stats" role="tab" aria-controls="stats" aria-selected="false">Th·ªëng K√™</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="charts-tab" data-toggle="pill" href="#charts" role="tab" aria-controls="charts" aria-selected="false">Bi·ªÉu ƒê·ªì</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="bracket-tab" data-toggle="pill" href="#bracket" role="tab" aria-controls="bracket" aria-selected="false">Bracket</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="teams-tab" data-toggle="pill" href="#teams" role="tab" aria-controls="teams" aria-selected="false">C√°c ƒê·ªôi</a>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="tournamentTabContent">
                <!-- Fixtures Tab -->
                        <div class="tab-pane fade show active" id="fixtures" role="tabpanel" aria-labelledby="fixtures-tab">
                            <% if (tournament.fixtures && tournament.fixtures.length > 0) { %>
                                <% tournament.fixtures.forEach(group => { %>
                                    <div class="mb-4">
                                        <h5 class="text-primary font-weight-bold border-bottom pb-2 mb-3"><%= group.group %></h5>
                                        <% if (group.matches && group.matches.length > 0) { %>
                                            <% group.matches.forEach(match => { 
                                                let logo1 = 'default.png';
                                                let logo2 = 'default.png';
                                                if (tournament.teams) {
                                                    let t1 = tournament.teams.find(t => t.name === match.team1);
                                                    if (t1) logo1 = t1.logo;
                                                    let t2 = tournament.teams.find(t => t.name === match.team2);
                                                    if (t2) logo2 = t2.logo;
                                                }
                                            %>
                                                <div class="card mb-3 shadow-sm border-0 match-card">
                                                    <div class="card-body py-3">
                                                        <div class="row align-items-center">
                                                            <!-- Team 1 -->
                                                            <div class="col-5 text-right d-flex align-items-center justify-content-end">
                                                                <span class="font-weight-bold mr-3 d-none d-md-block"><%= match.team1 %></span>
                                                                <img src="/static/images/<%= logo1 %>" onerror="this.src='/static/images/default.png'" class="rounded-circle border" width="40" height="40" alt="<%= match.team1 %>">
                                                            </div>
                                                            
                                                            <!-- Score / Time -->
                                                            <div class="col-2 text-center">
                                                                <% if (match.score1 !== null && match.score1 !== undefined && match.score1 !== "") { %>
                                                                    <div class="font-weight-bold h5 mb-0 text-dark">
                                                                        <%= match.score1 %> - <%= match.score2 %>
                                                                    </div>
                                                                    <small class="text-success font-weight-bold">FT</small>
                                                                <% } else { %>
                                                                    <div class="badge badge-light border px-2 py-1 mb-1">VS</div>
                                                                    <small class="d-block text-muted"><%= match.time %></small>
                                                                    <small class="d-block text-muted"><%= match.date %></small>
                                                                <% } %>
                                                                
                                                                <button class="btn btn-sm btn-outline-primary mt-2 shadow-sm rounded-pill" onclick="openMatchDetail('<%= match.id %>')">
                                                                    <i class="fa fa-eye"></i>
                                                                </button>
                                                            </div>

                                                            <!-- Team 2 -->
                                                            <div class="col-5 text-left d-flex align-items-center">
                                                                <img src="/static/images/<%= logo2 %>" onerror="this.src='/static/images/default.png'" class="rounded-circle border ml-0 ml-md-0" width="40" height="40" alt="<%= match.team2 %>">
                                                                <span class="font-weight-bold ml-3 d-none d-md-block"><%= match.team2 %></span>
                                                            </div>
                                                        </div>
                                                        <!-- Mobile Team Names -->
                                                        <div class="row d-md-none mt-2">
                                                            <div class="col-6 text-center"><small class="font-weight-bold"><%= match.team1 %></small></div>
                                                            <div class="col-6 text-center"><small class="font-weight-bold"><%= match.team2 %></small></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            <% }) %>
                                        <% } else { %>
                                            <p class="text-muted font-italic ml-3">Ch∆∞a c√≥ tr·∫≠n ƒë·∫•u n√†o trong b·∫£ng n√†y.</p>
                                        <% } %>
                                    </div>
                                <% }) %>
                            <% } else { %>
                                <div class="alert alert-info text-center">Ch∆∞a c√≥ l·ªãch thi ƒë·∫•u.</div>
                            <% } %>
                        </div>

                        <!-- Standings Tab -->
                        <div class="tab-pane fade" id="standings" role="tabpanel" aria-labelledby="standings-tab">
                            <div class="card shadow-sm mb-4 border-0">
                                <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 font-weight-bold">üìà B·∫£ng X·∫øp H·∫°ng</h5>
                                    <button onclick="exportImage('standings', 'BangXepHang')" class="btn btn-sm btn-outline-dark shadow-sm">
                                        <i class="fa fa-camera"></i> T·∫£i ·∫¢nh BXH
                                    </button>
                                </div>
                                <div class="card-body bg-white">
                                    <div class="row">
                                        <% if (tournament.standings && tournament.standings.length > 0) { %>
                                            <% tournament.standings.forEach(group => { %>
                                                <div class="col-lg-6 mb-4">
                                                    <h6 class="font-weight-bold text-primary pl-2 border-left border-primary mb-2" style="border-width: 4px !important;">
                                                        <%= group.groupName %>
                                                    </h6>
                                                    <div class="table-responsive">
                                                        <table class="table table-hover table-sm table-bordered text-center align-middle mb-0" style="font-size: 14px;">
                                                            <thead class="thead-light">
                                                                <tr>
                                                                    <th class="text-left w-50">CLB</th>
                                                                    <th>Tr</th>
                                                                    <th>T</th>
                                                                    <th>H</th>
                                                                    <th>B</th>
                                                                    <th>HS</th>
                                                                    <th>ƒê</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <% group.teams.forEach((team, index) => { %>
                                                                    <tr class="<%= index < 2 ? 'table-success' : '' %>">
                                                                        <td class="text-left font-weight-bold text-nowrap px-2">
                                                                            <span class="mr-2 text-secondary"><%= index + 1 %></span>
                                                                            <img src="/static/images/<%= team.logo %>" width="20" height="20" class="rounded-circle border mr-1" onerror="this.src='/static/images/default.png'">
                                                                            <%= team.name %>
                                                                        </td>
                                                                        <td><%= team.played %></td>
                                                                        <td><%= team.won %></td>
                                                                        <td><%= team.drawn %></td>
                                                                        <td><%= team.lost %></td>
                                                                        <td><%= team.gd > 0 ? '+' + team.gd : team.gd %></td>
                                                                        <td class="font-weight-bold text-danger bg-light"><%= team.points %></td>
                                                                    </tr>
                                                                <% }) %>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            <% }) %>
                                        <% } else { %>
                                            <div class="col-12 text-center text-muted">Ch∆∞a c√≥ b·∫£ng x·∫øp h·∫°ng.</div>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>

                <!-- Stats Tab -->
                <div class="tab-pane fade" id="stats" role="tabpanel" aria-labelledby="stats-tab">
                    <div class="bg-light p-4 rounded text-center">
                        <h4 class="mb-4 text-uppercase">Th·ªëng K√™</h4>
                        <p>T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</p>
                    </div>
                </div>

                <!-- Charts Tab -->
                <div class="tab-pane fade" id="charts" role="tabpanel" aria-labelledby="charts-tab">
                    <div class="bg-light p-4 rounded text-center">
                        <h4 class="mb-4 text-uppercase">Bi·ªÉu ƒê·ªì</h4>
                        <p>T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t...</p>
                    </div>
                </div>

                <!-- Bracket Tab -->
                <div class="tab-pane fade" id="bracket" role="tabpanel" aria-labelledby="bracket-tab">
                    <div class="bg-light p-4 rounded">
                        <h4 class="mb-4 text-uppercase">S∆° ƒê·ªì Thi ƒê·∫•u</h4>
                        <div id="bracket-container" style="overflow-x: auto;"></div>
                    </div>
                </div>

                <!-- Teams Tab -->
                <div class="tab-pane fade" id="teams" role="tabpanel" aria-labelledby="teams-tab">
                    <div class="bg-light p-4 rounded">
                        <h4 class="mb-4 text-uppercase">C√°c ƒê·ªôi Tham Gia</h4>
                        <div class="row">
                            <% if (tournament.teams && tournament.teams.length > 0) { %>
                                <% tournament.teams.forEach(team => { %>
                                    <div class="col-6 col-md-3 mb-4">
                                        <div class="card h-100 text-center p-3 shadow-sm border-0">
                                            <% 
                                                let logo = 'default.png';
                                                let name = 'Unknown';
                                                if (typeof team === 'string') {
                                                    name = team;
                                                } else if (typeof team === 'object') {
                                                    name = team.name;
                                                    logo = team.logo || 'default.png';
                                                }
                                            %>
                                            <img src="/static/images/<%= logo %>" onerror="this.src='/static/images/default.png'" class="img-fluid mx-auto d-block mb-3 rounded-circle border" style="width: 80px; height: 80px; object-fit: contain;">
                                            <h6 class="card-title mb-0 font-weight-bold"><%= name %></h6>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <p class="col-12 text-center">Ch∆∞a c√≥ danh s√°ch ƒë·ªôi.</p>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Detail End -->

    <!-- Match Detail Modal (Read Only) -->
    <div class="modal fade" id="matchDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="matchDetailTitle">Chi Ti·∫øt Tr·∫≠n ƒê·∫•u</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body p-0">
                    <!-- Score Header -->
                    <div class="d-flex justify-content-between align-items-center p-3 bg-light border-bottom">
                        <h4 class="text-primary mb-0 w-25 text-right" id="matchTeam1Name">Team 1</h4>
                        <div class="d-flex align-items-center justify-content-center w-50">
                            <span id="matchScore1" class="font-weight-bold h2 mb-0 mx-3">0</span>
                            <span class="font-weight-bold h3 mb-0">-</span>
                            <span id="matchScore2" class="font-weight-bold h2 mb-0 mx-3">0</span>
                        </div>
                        <h4 class="text-primary mb-0 w-25 text-left" id="matchTeam2Name">Team 2</h4>
                    </div>

                    <!-- Tabs -->
                    <ul class="nav nav-tabs nav-fill" id="matchTabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active font-weight-bold" id="lineup-tab-modal" data-toggle="tab" href="#lineup-modal" role="tab">
                                <i class="fa fa-users mr-2"></i>ƒê·ªôi H√¨nh
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link font-weight-bold" id="events-tab-modal" data-toggle="tab" href="#events-modal" role="tab">
                                <i class="fa fa-list-alt mr-2"></i>Di·ªÖn Bi·∫øn
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <!-- Lineup Tab -->
                        <div class="tab-pane fade show active" id="lineup-modal" role="tabpanel">
                            <div class="row no-gutters">
                                <!-- Team 1 Field -->
                                <div class="col-lg-6 border-right">
                                    <div class="p-2 text-center bg-light border-bottom font-weight-bold" id="lineupTeam1Name">Team 1</div>
                                    <div class="soccer-pitch-container">
                                        <div class="soccer-pitch" id="pitch-team1">
                                            <!-- Positions will be generated here -->
                                        </div>
                                    </div>
                                    <div class="p-3 bg-light border-top">
                                        <h6 class="text-muted small text-uppercase font-weight-bold mb-2">D·ª± b·ªã</h6>
                                        <div class="subs-container" id="subs-team1">
                                            <!-- Subs generated here -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Team 2 Field -->
                                <div class="col-lg-6">
                                    <div class="p-2 text-center bg-light border-bottom font-weight-bold" id="lineupTeam2Name">Team 2</div>
                                    <div class="soccer-pitch-container">
                                        <div class="soccer-pitch" id="pitch-team2">
                                            <!-- Positions will be generated here -->
                                        </div>
                                    </div>
                                    <div class="p-3 bg-light border-top">
                                        <h6 class="text-muted small text-uppercase font-weight-bold mb-2">D·ª± b·ªã</h6>
                                        <div class="subs-container" id="subs-team2">
                                            <!-- Subs generated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Events Tab (Placeholder) -->
                        <div class="tab-pane fade" id="events-modal" role="tabpanel">
                            <div class="p-4 text-center text-muted">
                                <i class="fa fa-info-circle fa-3x mb-3"></i>
                                <p>Ch∆∞a c√≥ d·ªØ li·ªáu di·ªÖn bi·∫øn tr·∫≠n ƒë·∫•u.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .soccer-pitch-container {
            padding: 20px;
            background: #2e7d32;
            display: flex;
            justify-content: center;
        }
        .soccer-pitch {
            width: 300px;
            height: 400px;
            border: 2px solid rgba(255,255,255,0.8);
            position: relative;
            background-image: 
                linear-gradient(rgba(255,255,255,0.2) 2px, transparent 2px),
                linear-gradient(90deg, rgba(255,255,255,0.2) 2px, transparent 2px),
                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
            border-radius: 5px;
        }
        /* Center Circle */
        .soccer-pitch::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
        }
        /* Halfway Line */
        .soccer-pitch::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255,255,255,0.5);
        }

        .player-position {
            position: absolute;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .player-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #ddd;
            border: 2px solid white;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .player-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .player-name {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            white-space: nowrap;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .position-label {
            position: absolute;
            top: -15px;
            color: rgba(255,255,255,0.8);
            font-size: 10px;
            font-weight: bold;
        }

        .subs-container {
            min-height: 60px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background: white;
        }
        .sub-player {
            width: 60px;
            text-align: center;
        }
        .sub-player .player-avatar {
            width: 40px;
            height: 40px;
            margin: 0 auto 5px;
        }
        .sub-player .player-name {
            background: #6c757d;
            font-size: 9px;
        }
    </style>

    <script>
        const tournamentData = JSON.parse(decodeURIComponent('<%- encodeURIComponent(JSON.stringify(tournament)) %>'));

        // Position Configs (Same as Admin)
        const PITCH_CONFIGS = {
            '5': [
                {role: 'GK', top: '90%', left: '50%'},
                {role: 'DF', top: '70%', left: '30%'}, {role: 'DF', top: '70%', left: '70%'},
                {role: 'FW', top: '30%', left: '30%'}, {role: 'FW', top: '30%', left: '70%'}
            ],
            '7': [
                {role: 'GK', top: '90%', left: '50%'},
                {role: 'CD', top: '75%', left: '50%'},
                {role: 'LM', top: '50%', left: '15%'}, {role: 'RM', top: '50%', left: '85%'}, {role: 'CM', top: '50%', left: '50%'},
                {role: 'FW', top: '25%', left: '35%'}, {role: 'FW', top: '25%', left: '65%'}
            ]
        };

        function openMatchDetail(matchId) {
            let currentMatch = null;
            // Find match
            if (tournamentData.fixtures) {
                for (const group of tournamentData.fixtures) {
                    const m = group.matches.find(m => m.id === matchId);
                    if (m) {
                        currentMatch = m;
                        break;
                    }
                }
            }

            if (!currentMatch) return;

            // Populate Header
            document.getElementById('matchTeam1Name').innerText = currentMatch.team1;
            document.getElementById('matchTeam2Name').innerText = currentMatch.team2;
            document.getElementById('matchScore1').innerText = (currentMatch.score1 !== null && currentMatch.score1 !== undefined) ? currentMatch.score1 : '-';
            document.getElementById('matchScore2').innerText = (currentMatch.score2 !== null && currentMatch.score2 !== undefined) ? currentMatch.score2 : '-';

            // Determine Pitch Type
            let pitchType = '7'; // Default
            if (tournamentData.pitchType) {
                pitchType = tournamentData.pitchType;
            } else if (tournamentData.mode) {
                if (tournamentData.mode.includes('5')) pitchType = '5';
            }

            // Render Lineups
            const positions = PITCH_CONFIGS[pitchType] || PITCH_CONFIGS['7'];

            renderTeamLineup('team1', currentMatch.team1, currentMatch.lineup1 || [], positions);
            renderTeamLineup('team2', currentMatch.team2, currentMatch.lineup2 || [], positions);

            // Show Modal
            $('#matchDetailModal').modal('show');
        }

        function renderTeamLineup(side, teamName, currentLineup, positions) {
            const team = tournamentData.teams.find(t => t.name === teamName);
            const members = team ? (team.members || []) : [];
            
            const pitchContainer = document.getElementById(`pitch-${side}`);
            const subsContainer = document.getElementById(`subs-${side}`);
            
            pitchContainer.innerHTML = '';
            subsContainer.innerHTML = '';

            // 1. Render Pitch Positions
            positions.forEach((pos, index) => {
                const posDiv = document.createElement('div');
                posDiv.className = 'player-position';
                posDiv.style.top = pos.top;
                posDiv.style.left = pos.left;

                // Check if player is assigned
                const assignedPlayerId = currentLineup[index];
                const player = assignedPlayerId ? members.find(m => m.id === assignedPlayerId || m.name === assignedPlayerId) : null;

                if (player) {
                    posDiv.innerHTML = `
                        <div class="position-label">${pos.role}</div>
                        <div class="player-avatar">
                            ${player.avatar && player.avatar !== 'default-avatar.png' ? 
                                `<img src="/static/uploads/tournaments/${player.avatar}">` : 
                                `<i class="fa fa-user text-secondary"></i>`}
                        </div>
                        <div class="player-name">${player.name}</div>
                    `;
                } else {
                    posDiv.innerHTML = `
                        <div class="position-label">${pos.role}</div>
                        <div class="player-avatar bg-transparent border-dashed" style="border-style: dashed; opacity: 0.5;">
                            
                        </div>
                        
                    `;
                }
                pitchContainer.appendChild(posDiv);
            });

            // 2. Render Subs (Everyone not in lineup)
            members.forEach(member => {
                const isInLineup = currentLineup.includes(member.id) || currentLineup.includes(member.name);
                
                if (!isInLineup) {
                    const subDiv = document.createElement('div');
                    subDiv.className = 'sub-player';
                    subDiv.innerHTML = `
                        <div class="player-avatar">
                            ${member.avatar && member.avatar !== 'default-avatar.png' ? 
                                `<img src="/static/uploads/tournaments/${member.avatar}">` : 
                                `<div class="bg-secondary w-100 h-100 d-flex align-items-center justify-content-center text-white"><i class="fa fa-user"></i></div>`}
                        </div>
                        <div class="player-name">${member.name}</div>
                    `;
                    subsContainer.appendChild(subDiv);
                }
            });
        }
    </script>

    <!-- Footer Start -->
    <%- include('partical/footercomponent'); %>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="/static/lib/easing/easing.min.js"></script>
    <script src="/static/lib/waypoints/waypoints.min.js"></script>
    <script src="/static/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="/static/lib/tempusdominus/js/moment.min.js"></script>
    <script src="/static/lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="/static/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="/static/js/main.js"></script>

    <script id="bracket-data" type="application/json">
        <%- JSON.stringify(tournament.bracketData || null) %>
    </script>

    <script>
        $(document).ready(function () {
            // Render Bracket if data exists
            var bracketData = null;
            try {
                var rawData = document.getElementById('bracket-data').textContent;
                if (rawData) {
                    bracketData = JSON.parse(rawData);
                }
            } catch (e) {
                console.error("Error parsing bracket data", e);
            }

            if (bracketData) {
                $('#bracket-container').bracket({
                    init: bracketData
                });
            } else {
                $('#bracket-container').html('<p class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu s∆° ƒë·ªì.</p>');
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function exportImage(elementId, fileName) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            // Show loading or feedback if needed
            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> ƒêang t·∫£i...';
            btn.disabled = true;

            html2canvas(element).then(canvas => {
                const link = document.createElement('a');
                link.download = fileName + '.png';
                link.href = canvas.toDataURL();
                link.click();
                
                btn.innerHTML = originalText;
                btn.disabled = false;
            }).catch(err => {
                console.error('Export failed:', err);
                alert('Kh√¥ng th·ªÉ t·∫£i ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i.');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
    </script>
</body>

</html>
