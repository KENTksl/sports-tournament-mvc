<div class="container-fluid bg-white position-relative">
    <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0">
        <a href="index.html" class="navbar-brand text-secondary">
            <h1 class="display-4 text-uppercase">SPORT TOURNAMENT</h1>
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ml-auto py-0 pr-3 border-right">
                <a href="home" class="nav-item nav-link ">TRANG CHỦ</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">THỂ THAO</a>
                    <div class="dropdown-menu rounded-0 m-0">
                        <a href="football" class="dropdown-item">BÓNG ĐÁ</a>
                        <a href="update" class="dropdown-item">BÓNG RỔ</a>
                        <a href="update" class="dropdown-item">CẦU LÔNG</a>
                        <a href="update" class="dropdown-item">PICKLEBALL</a>
                    </div>
                </div>
                <a href="news" class="nav-item nav-link ">TIN TỨC</a>
                <a href="about" class="nav-item nav-link">GIỚI THIỆU</a>
                <a href="contact" class="nav-item nav-link">LIÊN HỆ</a>
                <a href="login" class="nav-item nav-link" id="loginLink">ĐĂNG NHẬP</a>
                
                <!-- Profile Dropdown (Hidden by default) -->
                <div class="nav-item dropdown" id="profileDropdown" style="display: none;">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                        <i class="fa fa-user"></i> CÁ NHÂN
                    </a>
                    <div class="dropdown-menu rounded-0 m-0">
                        <a href="profile" class="dropdown-item">Trang Cá Nhân</a>
                        <a href="#" class="dropdown-item" id="logoutBtn">Đăng Xuất</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Active Link Logic
        const currentLocation = location.href;
        const menuItems = document.querySelectorAll('.navbar-nav .nav-link');
        const menuLength = menuItems.length;
        for (let i = 0; i < menuLength; i++) {
            if (menuItems[i].href === currentLocation) {
                menuItems[i].classList.add("active");
            }
        }

        // Login/Profile Logic
        const token = localStorage.getItem('token');
        const loginLink = document.getElementById('loginLink');
        const profileDropdown = document.getElementById('profileDropdown');
        const logoutBtn = document.getElementById('logoutBtn');

        // Helper to parse JWT
        function parseJwt(token) {
            try {
                var base64Url = token.split('.')[1];
                var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return null;
            }
        }

        // Check token validity
        let isTokenValid = false;
        if (token) {
            const decoded = parseJwt(token);
            if (decoded && decoded.exp) {
                const currentTime = Date.now() / 1000;
                if (decoded.exp < currentTime) {
                    // Token expired
                    localStorage.removeItem('token');
                    alert('Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại.');
                    window.location.href = '/login';
                } else {
                    isTokenValid = true;
                }
            } else {
                // Invalid token
                localStorage.removeItem('token');
            }
        }

        if (isTokenValid) {
            loginLink.style.display = 'none';
            profileDropdown.style.display = 'block';
        } else {
            loginLink.style.display = 'block';
            profileDropdown.style.display = 'none';
        }

        // Logout Logic
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('token');
                alert('Đã đăng xuất thành công');
                window.location.href = '/login';
            });
        }
    });
</script>